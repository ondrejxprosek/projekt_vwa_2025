<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ÃšÄtenka - {{ order.table.name }}</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/receipt.css', v=1) }}">
</head>
<body class="receipt-page">
<div class="receipt">
  <!-- HlaviÄka -->
  <div class="header">
    <div class="receipt-header">
      <img class="print-logo" src="{{ url_for('static', filename='img/logo_pokladnicka.png') }}" alt="PokladniÄka 2025">
    </div>
    <div class="subtitle">ÃšÄŒTENKA</div>
  </div>

  <!-- Informace o ÃºÄtu -->
  <div class="info-row">
    <span><strong>StÅ¯l:</strong> {{ order.table.name }}</span>
    <span><strong>ÃšÄet #</strong>{{ order.id }}</span>
  </div>
  <div class="info-row">
    <span><strong>Datum:</strong> {{ order.closed_at.strftime('%d.%m.%Y') if order.closed_at else order.opened_at.strftime('%d.%m.%Y') }}</span>
    <span><strong>ÄŒas:</strong> {{ order.closed_at.strftime('%H:%M:%S') if order.closed_at else order.opened_at.strftime('%H:%M:%S') }}</span>
  </div>

  <hr class="divider">

  <!-- PoloÅ¾ky -->
  <div class="items">
    {% if items %}
      {% set ns = namespace(total=0) %}
      {% for item in items %}
      <div class="item-line">
        <div class="item-name">{{ item.item.name }}</div>
        <div class="item-qty">{% if item.quantity > 1 %}Ã—{{ item.quantity }}{% endif %}</div>
        <div class="item-price">{{ "%.2f"|format(item.price * item.quantity) }} KÄ</div>
      </div>
      {% set ns.total = ns.total + (item.price * item.quantity) %}
      {% endfor %}
    {% endif %}
  </div>

  <hr class="divider">

  <!-- SouÄet -->
  <div class="total-row">
    <span>CELKEM K ÃšHRADÄš:</span>
    <span>{{ "%.2f"|format(total) }} KÄ</span>
  </div>

  <!-- PatiÄka -->
  <div class="footer">
    <div>DÄ›kujeme za nÃ¡kup!</div>
    <div style="margin-top: 6px;">www.itbvision.cz</div>
    <div style="margin-top: 8px; font-size: 11px; color: #ccc;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
  </div>

  <!-- TlaÄÃ­tka -->
  <div class="buttons">
    <button class="btn" onclick="handlePrint()">ğŸ–¨ï¸ Tisk</button>
    <button class="btn secondary" onclick="goBackToCashier()">âœ• ZpÄ›t na pokladnu</button>
  </div>
</div>

<script>
  function handlePrint() {
    window.print();
    // Po zavÅ™enÃ­ tisku se vrÃ¡tÃ­ na pokladnu
    setTimeout(() => {
      goBackToCashier();
    }, 1000);
  }

  function goBackToCashier() {
    if (window.opener) {
      // Pokud je otevÅ™eno v novÃ©m oknÄ›, zavÅ™i jej a zamÄ›Å™ se na pÅ¯vodnÃ­
      window.opener.location.href = "{{ url_for('cashier') }}";
      window.close();
    } else {
      // Pokud nenÃ­ otevÅ™eno v novÃ©m oknÄ›, pÅ™esmÄ›ruj pÅ™Ã­mo
      window.location.href = "{{ url_for('cashier') }}";
    }
  }

  // Automaticky otevÅ™i tisk, pokud se otevÅ™elo v novÃ©m oknÄ›
  if (window.opener && window.name === '') {
    setTimeout(() => window.print(), 500);
  }
</script>
</body>
</html>