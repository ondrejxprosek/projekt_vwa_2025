<!-- COMMENTS: shift+option+A or whole line shift+cmd+ú in jinja {# whatever #} -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>{{ title or 'Moje Aplikace' }}</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
<header class="navbar container">
    <a class="home-link" href="{{ url_for('index') }}" title="Domů">
      <img src="{{ url_for('static', filename='img/home.png') }}" alt="Domů" width="22" height="22" aria-hidden="true">
    </a>
    <a class="home-link" href="{{ url_for('cashier') }}" title="Pokladna">
      <img src="{{ url_for('static', filename='img/cashier.png') }}" alt="Pokladna" width="22" height="22" aria-hidden="true">
    </a>

    <div class="brand">
      <span class="badge" id="current-datetime">MOJE APLIKACE</span>
    </div>

    <!-- NOVĚ: hamburger tlačítko -->
    <button class="hamburger" id="menuBtn" aria-label="Menu" aria-expanded="false" aria-controls="navActions">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M3 6h18M3 12h18M3 18h18"></path>
      </svg>
    </button>

    <!-- Přidej id pro JS toggle -->
    <div class="nav-actions" id="navActions">
      {% if session.get('user_id') %}
      <div class="kv">{{ current_user.username }} • <span class="small-muted">{{ current_user.role }}</span></div>
      {% if perms.can_manage_users %}<a class="btn" href="{{ url_for('admin_panel') }}">Uživatelé</a>{% endif %}
      {% if perms.can_manage_users %}<a class="btn" href="{{ url_for('admin_permissions') }}">Role a práva</a>{% endif %}
      {% if perms.can_manage_tables %}<a class="btn" href="{{ url_for('tables') }}">Stoly</a>{% endif %}
      {% if perms.can_manage_items %}<a class="btn" href="{{ url_for('admin_items') }}">Položky</a>{% endif %}
      {% if perms.can_view_closed_orders %}<a class="btn" href="{{ url_for('closed_orders') }}">Uzavřené účty</a>{% endif %}
      <a class="btn" href="{{ url_for('logout') }}">Odhlásit</a>
      {% else %}
      <a class="btn" href="{{ url_for('login') }}">Přihlásit</a>
      <a class="btn" href="{{ url_for('register') }}">Registrovat</a>
      {% endif %}
    </div>
</header>


<main class="container">
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, msg in messages %}
<div class="flash flash-{{ 'success' if category=='success' else ('danger' if category=='danger' else 'info') }} card">
{{ msg }}
</div>
{% endfor %}
{% endif %}
{% endwith %}


{% block content %}{% endblock %}

<div class="footer">© {{ 2025 }} • ITB Vision s.r.o.</div>
</main>

<script>
// Aktualizace data a času každou sekundu
function updateDateTime() {
    const now = new Date();
    const options = {
        weekday: 'short',
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    };
    const formatted = now.toLocaleDateString('cs-CZ', options);
    document.getElementById('current-datetime').textContent = formatted;
}

updateDateTime();
setInterval(updateDateTime, 1000);

// Mobile hamburger toggle
(function () {
  const btn = document.getElementById('menuBtn');
  const nav = document.getElementById('navActions');
  if (!btn || !nav) return;

  btn.addEventListener('click', function (e) {
    e.stopPropagation();
    const open = nav.classList.toggle('is-open');
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
  });

  document.addEventListener('click', function (e) {
    if (!nav.contains(e.target) && !btn.contains(e.target)) {
      nav.classList.remove('is-open');
      btn.setAttribute('aria-expanded', 'false');
    }
  });

  window.addEventListener('resize', function () {
    if (window.innerWidth > 768) {
      nav.classList.remove('is-open');
      btn.setAttribute('aria-expanded', 'false');
    }
  });
})();
</script>

</body>
</html>